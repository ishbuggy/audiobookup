<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>AudioBookup - Settings</title>
        <link
            rel="icon"
            type="image/png"
            sizes="16x16"
            href="{{ url_for('static', filename='img/AudioBookup_Favicon_16.png') }}"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="{{ url_for('static', filename='img/AudioBookup_Favicon_32.png') }}"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="96x96"
            href="{{ url_for('static', filename='img/AudioBookup_Favicon_96.png') }}"
        />
        <link
            rel="apple-touch-icon"
            sizes="144x144"
            href="{{ url_for('static', filename='img/AudioBookup_Favicon_144.png') }}"
        />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
        <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    </head>
    <body>
        <div class="container">
            <!-- Main Page Header -->
            <div id="settings-page-header">
                <h1 style="text-align: left; margin: 0"><i class="fas fa-cog"></i> Settings</h1>
                <div class="header-controls">
                    <button
                        id="theme-toggle-btn"
                        class="top-right-icon-btn"
                        style="position: static; font-size: 1.2em"
                        title="Toggle Theme"
                    >
                        <i class="fas fa-moon"></i>
                    </button>
                    <!-- START: Advanced Mode Toggle Location -->
                    <div class="advanced-mode-control" title="Shows advanced options like cron scheduling">
                        <label for="advanced-mode-toggle">Advanced Mode</label>
                        <label class="switch">
                            <input
                                type="checkbox"
                                id="advanced-mode-toggle"
                                class="setting-input"
                                data-path="advanced_mode_enabled"
                                {%
                                if
                                settings.advanced_mode_enabled
                                %}checked{%
                                endif
                                %}
                            />
                            <span class="slider"></span>
                        </label>
                    </div>
                    <!-- END: Advanced Mode Toggle Location -->
                    <a
                        href="{{ url_for('index') }}"
                        class="action-button"
                        style="text-decoration: none; font-size: 1em; padding: 0.6em 1.2em"
                    >
                        <i class="fas fa-arrow-left"></i> Back to Dashboard
                    </a>
                </div>
            </div>
            <!-- Settings Accordion -->
            <div class="accordion">
                <div class="accordion-item">
                    <button class="accordion-header">
                        <div>
                            <span class="accordion-title"><i class="fas fa-tasks"></i> Job Settings</span>
                            <span class="accordion-description">Manage job concurrency and parallelism</span>
                        </div>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="accordion-panel">
                        <!-- MOVED: This setting is now always visible, not tied to a mode. -->
                        <div class="form-group">
                            <label for="total-processing-cores-input">
                                Total Processing Cores
                                <small style="display: block; font-weight: normal; color: #6c757d">
                                    The global limit for CPU-intensive tasks. A good default is your system's total CPU
                                    cores minus one.
                                </small>
                            </label>
                            <div style="display: flex; align-items: center; gap: 0.5em">
                                <input
                                    type="number"
                                    id="total-processing-cores-input"
                                    class="setting-input"
                                    data-path="job.download.total_processing_cores"
                                    value="{{ settings.job.download.total_processing_cores | default(2) }}"
                                    min="1"
                                    max="16"
                                />
                                <button
                                    id="auto-concurrency-btn"
                                    class="action-button"
                                    title="Auto-detect based on system hardware"
                                >
                                    <i class="fas fa-magic"></i> Auto-detect
                                </button>
                            </div>
                        </div>

                        <!-- This setting remains in Advanced Mode only -->
                        <div class="form-group advanced-setting">
                            <label for="max-parallel-downloads-input">
                                Max Parallel Downloads
                                <small style="display: block; font-weight: normal; color: #6c757d">
                                    Limits how many books are downloaded from Audible at the same time.
                                </small>
                            </label>
                            <input
                                type="number"
                                id="max-parallel-downloads-input"
                                class="setting-input"
                                data-path="job.download.max_parallel_downloads"
                                value="{{ settings.job.download.max_parallel_downloads | default(2) }}"
                                min="1"
                                max="5"
                            />
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <button class="accordion-header">
                        <!-- START: Simplified Structure -->
                        <div>
                            <span class="accordion-title"><i class="fas fa-folder"></i> File & Folder Naming</span>
                            <span class="accordion-description">Define the output file path and name</span>
                        </div>
                        <i class="fas fa-chevron-down"></i>
                        <!-- END: Simplified Structure -->
                    </button>
                    <div class="accordion-panel">
                        <div class="form-group" style="flex-direction: column; align-items: flex-start">
                            <label for="naming-template" style="margin-bottom: 0.5em">Folder/File Name Template:</label>
                            <input
                                type="text"
                                id="naming-template"
                                class="setting-input"
                                data-path="naming.template"
                                style="width: 100%; box-sizing: border-box"
                                value="{{ settings.naming.template | default('{author}/{title}') }}"
                            />
                            <small style="margin-top: 0.75em; color: #6c757d">
                                Placeholders: <code>{author}</code>, <code>{title}</code>, <code>{series}</code>,
                                <code>{series_part}</code>
                            </small>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <button class="accordion-header">
                        <!-- START: Simplified Structure -->
                        <div>
                            <span class="accordion-title"><i class="fas fa-sliders-h"></i> Conversion Settings</span>
                            <span class="accordion-description">Control audio quality and format</span>
                        </div>
                        <i class="fas fa-chevron-down"></i>
                        <!-- END: Simplified Structure -->
                    </button>
                    <div class="accordion-panel">
                        <div class="form-group">
                            <label for="conversion-quality">Audio Quality:</label>
                            <!-- prettier-ignore -->
                            <select id="conversion-quality" class="setting-input" data-path="conversion.quality">
                                <option value="High" {% if settings.conversion.quality == 'High' %}selected{% endif %}>High (AAC, ~128 kbps)</option>
                                <option value="Standard" {% if settings.conversion.quality == 'Standard' %}selected{% endif %}>Standard (AAC, ~96 kbps)</option>
                                <option value="Low" {% if settings.conversion.quality == 'Low' %}selected{% endif %}>Low (AAC, ~64 kbps)</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <button class="accordion-header">
                        <!-- START: Simplified Structure -->
                        <div>
                            <span class="accordion-title"><i class="fas fa-shield-alt"></i> Audible Connection</span>
                            <span class="accordion-description">Manually check your login status with Audible</span>
                        </div>
                        <i class="fas fa-chevron-down"></i>
                        <!-- END: Simplified Structure -->
                    </button>
                    <div class="accordion-panel">
                        <div class="form-group" style="flex-direction: column; align-items: flex-start; gap: 1em">
                            <button id="run-audible-auth-check-btn" class="action-button" style="font-size: 1em">
                                Run Connection Check
                            </button>
                            <div id="audible-auth-check-result" style="font-size: 0.9em; min-height: 1.2em"></div>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <button class="accordion-header" id="tasks-accordion-header">
                        <!-- START: Simplified Structure -->
                        <div>
                            <span class="accordion-title"><i class="fas fa-clock"></i> Scheduled Tasks</span>
                            <span class="accordion-description">Configure automated background tasks</span>
                        </div>
                        <i class="fas fa-chevron-down"></i>
                        <!-- END: Simplified Structure -->
                    </button>
                    <div class="accordion-panel">
                        <div class="form-group">
                            <label for="timezone-select">
                                Scheduler Timezone:
                                <small style="display: block; font-weight: normal; color: #6c757d"
                                    >Sets the timezone for all daily and cron schedules.</small
                                >
                            </label>
                            <!-- prettier-ignore -->
                            <select id="timezone-select" class="setting-input" data-path="tasks.timezone">
                                <option value="UTC" {% if settings.tasks.timezone == 'UTC' %}selected{% endif %}>UTC</option>
                                <option value="Europe/London" {% if settings.tasks.timezone == 'Europe/London' %}selected{% endif %}>Europe/London</option>
                                <option value="Europe/Berlin" {% if settings.tasks.timezone == 'Europe/Berlin' %}selected{% endif %}>Europe/Berlin</option>
                                <option value="America/New_York" {% if settings.tasks.timezone == 'America/New_York' %}selected{% endif %}>America/New York (ET)</option>
                                <option value="America/Chicago" {% if settings.tasks.timezone == 'America/Chicago' %}selected{% endif %}>America/Chicago (CT)</option>
                                <option value="America/Denver" {% if settings.tasks.timezone == 'America/Denver' %}selected{% endif %}>America/Denver (MT)</option>
                                <option value="America/Los_Angeles" {% if settings.tasks.timezone == 'America/Los_Angeles' %}selected{% endif %}>America/Los Angeles (PT)</option>
                                <option value="Australia/Sydney" {% if settings.tasks.timezone == 'Australia/Sydney' %}selected{% endif %}>Australia/Sydney</option>
                                <option value="Asia/Tokyo" {% if settings.tasks.timezone == 'Asia/Tokyo' %}selected{% endif %}>Asia/Tokyo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="audible-auth-check-interval">Audible Connection Check Interval (hours):</label>
                            <input
                                type="number"
                                id="audible-auth-check-interval"
                                class="setting-input"
                                data-path="tasks.audible_auth_check_interval_hours"
                                value="{{ settings.tasks.audible_auth_check_interval_hours | default(6) }}"
                                min="1"
                                max="24"
                            />
                        </div>

                        <!-- START: FAST SYNC SCHEDULE UI -->
                        <div class="setting-item toggle-control" style="border-top: 1px solid #e9ecef">
                            <label for="auto-fast-sync-toggle">
                                <strong>Enable Automatic Fast Sync (API Only)</strong>
                                <small style="display: block; font-weight: normal; color: #6c757d">
                                    Checks for new books and metadata. Runs quickly and does not use the filesystem.
                                </small>
                            </label>
                            <div style="display: flex; align-items: center; gap: 1em">
                                <button
                                    class="run-now-btn advanced-setting"
                                    data-job-type="FAST_SYNC"
                                    title="Run Fast Sync Now"
                                    disabled
                                >
                                    <i class="fas fa-play"></i>
                                </button>
                                <label class="switch">
                                    <input
                                        type="checkbox"
                                        id="auto-fast-sync-toggle"
                                        class="setting-input"
                                        data-path="tasks.is_auto_fast_sync_enabled"
                                        {%
                                        if
                                        settings.tasks.is_auto_fast_sync_enabled
                                        %}checked{%
                                        endif
                                        %}
                                    />
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="setting-item-group" id="auto-fast-sync-options">
                            <div class="form-group schedule-type-group" style="gap: 2em">
                                <label>Schedule Type:</label>
                                <div class="radio-buttons-wrapper">
                                    <div style="flex-grow: 1"></div>
                                    <label class="radio-group-item">
                                        <input type="radio" name="fast_sync_schedule_type" value="interval" />
                                        <span class="radio-circle"><span class="radio-dot"></span></span>
                                        Interval
                                    </label>
                                    <label class="radio-group-item">
                                        <input type="radio" name="fast_sync_schedule_type" value="daily" />
                                        <span class="radio-circle"><span class="radio-dot"></span></span>
                                        Daily
                                    </label>
                                    <label class="radio-group-item advanced-setting">
                                        <input type="radio" name="fast_sync_schedule_type" value="cron" />
                                        <span class="radio-circle"><span class="radio-dot"></span></span>
                                        Cron
                                    </label>
                                    <label
                                        class="radio-group-item"
                                        id="fast_sync-custom-label"
                                        style="display: none; color: #6c757d; font-style: italic"
                                        >Custom</label
                                    >
                                </div>
                            </div>
                            <div class="form-group" id="fast_sync-interval-container">
                                <label for="fast_sync-interval-hours">Run every (hours):</label>
                                <input type="number" id="fast_sync-interval-hours" value="4" min="1" max="168" />
                            </div>
                            <div class="form-group" id="fast_sync-daily-container">
                                <label for="fast_sync-daily-time">Run at (time):</label>
                                <input type="time" id="fast_sync-daily-time" value="02:00" />
                            </div>
                            <div class="setting-item advanced-setting" id="fast_sync-cron-container">
                                <small>
                                    Paste a full cron string into the first box to auto-populate. |
                                    <a href="https://crontab.guru/" target="_blank" rel="noopener noreferrer"
                                        >How to schedule with cron</a
                                    >
                                </small>
                                <div class="cron-input-group">
                                    <input
                                        type="text"
                                        id="fast_sync-cron-minute"
                                        placeholder="M"
                                        title="Minute (0-59)"
                                    />
                                    <input type="text" id="fast_sync-cron-hour" placeholder="H" title="Hour (0-23)" />
                                    <input
                                        type="text"
                                        id="fast_sync-cron-dom"
                                        placeholder="DM"
                                        title="Day of Month (1-31)"
                                    />
                                    <input
                                        type="text"
                                        id="fast_sync-cron-month"
                                        placeholder="Mth"
                                        title="Month (1-12)"
                                    />
                                    <input
                                        type="text"
                                        id="fast_sync-cron-dow"
                                        placeholder="DW"
                                        title="Day of Week (0-6)"
                                    />
                                </div>
                            </div>
                        </div>
                        <!-- END: FAST SYNC SCHEDULE UI -->

                        <!-- START: DEEP SYNC SCHEDULE UI -->
                        <div class="setting-item toggle-control" style="border-top: 1px solid #e9ecef">
                            <label for="auto-deep-sync-toggle">
                                <strong>Enable Automatic Deep Sync (Full Scan)</strong>
                                <small style="display: block; font-weight: normal; color: #6c757d">
                                    Performs a Fast Sync, then scans all local files. Use less frequently.
                                </small>
                            </label>
                            <div style="display: flex; align-items: center; gap: 1em">
                                <button
                                    class="run-now-btn advanced-setting"
                                    data-job-type="DEEP_SYNC"
                                    title="Run Deep Sync Now"
                                    disabled
                                >
                                    <i class="fas fa-play"></i>
                                </button>
                                <label class="switch">
                                    <input
                                        type="checkbox"
                                        id="auto-deep-sync-toggle"
                                        class="setting-input"
                                        data-path="tasks.is_auto_deep_sync_enabled"
                                        {%
                                        if
                                        settings.tasks.is_auto_deep_sync_enabled
                                        %}checked{%
                                        endif
                                        %}
                                    />
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="setting-item-group" id="auto-deep-sync-options">
                            <div class="form-group schedule-type-group" style="gap: 2em">
                                <label>Schedule Type:</label>
                                <div class="radio-buttons-wrapper">
                                    <div style="flex-grow: 1"></div>
                                    <label class="radio-group-item">
                                        <input type="radio" name="deep_sync_schedule_type" value="interval" />
                                        <span class="radio-circle"><span class="radio-dot"></span></span>
                                        Interval
                                    </label>
                                    <label class="radio-group-item">
                                        <input type="radio" name="deep_sync_schedule_type" value="daily" />
                                        <span class="radio-circle"><span class="radio-dot"></span></span>
                                        Daily
                                    </label>
                                    <label class="radio-group-item advanced-setting">
                                        <input type="radio" name="deep_sync_schedule_type" value="cron" />
                                        <span class="radio-circle"><span class="radio-dot"></span></span>
                                        Cron
                                    </label>
                                    <label
                                        class="radio-group-item"
                                        id="deep_sync-custom-label"
                                        style="display: none; color: #6c757d; font-style: italic"
                                        >Custom</label
                                    >
                                </div>
                            </div>
                            <div class="form-group" id="deep_sync-interval-container">
                                <label for="deep_sync-interval-hours">Run every (hours):</label>
                                <input type="number" id="deep_sync-interval-hours" value="24" min="2" max="168" />
                            </div>
                            <div class="form-group" id="deep_sync-daily-container">
                                <label for="deep_sync-daily-time">Run at (time):</label>
                                <input type="time" id="deep_sync-daily-time" value="03:00" />
                            </div>
                            <div class="setting-item advanced-setting" id="deep_sync-cron-container">
                                <small>
                                    Paste a full cron string into the first box to auto-populate. |
                                    <a href="https://crontab.guru/" target="_blank" rel="noopener noreferrer"
                                        >How to schedule with cron</a
                                    >
                                </small>
                                <div class="cron-input-group">
                                    <input
                                        type="text"
                                        id="deep_sync-cron-minute"
                                        placeholder="M"
                                        title="Minute (0-59)"
                                    />
                                    <input type="text" id="deep_sync-cron-hour" placeholder="H" title="Hour (0-23)" />
                                    <input
                                        type="text"
                                        id="deep_sync-cron-dom"
                                        placeholder="DM"
                                        title="Day of Month (1-31)"
                                    />
                                    <input
                                        type="text"
                                        id="deep_sync-cron-month"
                                        placeholder="Mth"
                                        title="Month (1-12)"
                                    />
                                    <input
                                        type="text"
                                        id="deep_sync-cron-dow"
                                        placeholder="DW"
                                        title="Day of Week (0-6)"
                                    />
                                </div>
                            </div>
                        </div>
                        <!-- END: DEEP SYNC SCHEDULE UI -->

                        <!-- START: NEW PROCESS SCHEDULE UI -->
                        <div class="setting-item toggle-control" style="border-top: 1px solid #e9ecef">
                            <label for="auto-process-toggle"
                                ><strong>Enable Automatic Processing/Downloading</strong></label
                            >
                            <div style="display: flex; align-items: center; gap: 1em">
                                <button
                                    class="run-now-btn advanced-setting"
                                    data-job-type="PROCESS"
                                    title="Run Process Job Now"
                                    disabled
                                >
                                    <i class="fas fa-play"></i>
                                </button>
                                <label class="switch">
                                    <input
                                        type="checkbox"
                                        id="auto-process-toggle"
                                        class="setting-input"
                                        data-path="tasks.is_auto_process_enabled"
                                        {%
                                        if
                                        settings.tasks.is_auto_process_enabled
                                        %}checked{%
                                        endif
                                        %}
                                    />
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="setting-item-group" id="auto-process-options">
                            <div class="form-group schedule-type-group" style="gap: 2em">
                                <label>Schedule Type:</label>
                                <div class="radio-buttons-wrapper">
                                    <div style="flex-grow: 1"></div>
                                    <label class="radio-group-item">
                                        <input type="radio" name="process_schedule_type" value="interval" />
                                        <span class="radio-circle"><span class="radio-dot"></span></span>
                                        Interval
                                    </label>
                                    <label class="radio-group-item">
                                        <input type="radio" name="process_schedule_type" value="daily" />
                                        <span class="radio-circle"><span class="radio-dot"></span></span>
                                        Daily
                                    </label>
                                    <label class="radio-group-item advanced-setting">
                                        <input type="radio" name="process_schedule_type" value="cron" />
                                        <span class="radio-circle"><span class="radio-dot"></span></span>
                                        Cron
                                    </label>
                                    <label
                                        class="radio-group-item"
                                        id="process-custom-label"
                                        style="display: none; color: #6c757d; font-style: italic"
                                        >Custom</label
                                    >
                                </div>
                            </div>
                            <div class="form-group" id="process-interval-container">
                                <label for="process-interval-hours">Run every (hours):</label>
                                <input type="number" id="process-interval-hours" value="24" min="2" max="168" />
                            </div>
                            <div class="form-group" id="process-daily-container">
                                <label for="process-daily-time">Run at (time):</label>
                                <input type="time" id="process-daily-time" value="04:00" />
                            </div>
                            <div class="setting-item advanced-setting" id="process-cron-container">
                                <small>
                                    Paste a full cron string into the first box to auto-populate. |
                                    <a href="https://crontab.guru/" target="_blank" rel="noopener noreferrer"
                                        >How to schedule with cron</a
                                    >
                                </small>
                                <div class="cron-input-group">
                                    <input type="text" id="process-cron-minute" placeholder="M" title="Minute (0-59)" />
                                    <input type="text" id="process-cron-hour" placeholder="H" title="Hour (0-23)" />
                                    <input
                                        type="text"
                                        id="process-cron-dom"
                                        placeholder="DM"
                                        title="Day of Month (1-31)"
                                    />
                                    <input type="text" id="process-cron-month" placeholder="Mth" title="Month (1-12)" />
                                    <input
                                        type="text"
                                        id="process-cron-dow"
                                        placeholder="DW"
                                        title="Day of Week (0-6)"
                                    />
                                </div>
                            </div>
                            <div
                                class="form-group"
                                style="
                                    flex-direction: column;
                                    align-items: flex-start;
                                    gap: 0.5em;
                                    border-top: 1px solid #e9ecef;
                                "
                            >
                                <label style="padding-top: 1em">Automatically process books with these statuses:</label>
                                <div style="display: flex; flex-direction: column; gap: 0.5em; padding-left: 1em">
                                    <label
                                        ><input
                                            type="checkbox"
                                            class="setting-input"
                                            data-path="tasks.auto_process_new"
                                            {%
                                            if
                                            settings.tasks.auto_process_new
                                            %}checked{%
                                            endif
                                            %}
                                        />
                                        NEW</label
                                    >
                                    <label
                                        ><input
                                            type="checkbox"
                                            class="setting-input"
                                            data-path="tasks.auto_process_missing"
                                            {%
                                            if
                                            settings.tasks.auto_process_missing
                                            %}checked{%
                                            endif
                                            %}
                                        />
                                        MISSING</label
                                    >
                                    <label
                                        ><input
                                            type="checkbox"
                                            id="auto-process-error-checkbox"
                                            class="setting-input"
                                            data-path="tasks.auto_process_error"
                                            {%
                                            if
                                            settings.tasks.auto_process_error
                                            %}checked{%
                                            endif
                                            %}
                                        />
                                        ERROR</label
                                    >
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="process-on-sync-checkbox"
                                    >Trigger immediate processing when new books are found by a sync</label
                                >
                                <label class="switch">
                                    <input
                                        type="checkbox"
                                        id="process-on-sync-checkbox"
                                        class="setting-input"
                                        data-path="tasks.process_new_on_sync"
                                        {%
                                        if
                                        settings.tasks.process_new_on_sync
                                        %}checked{%
                                        endif
                                        %}
                                    />
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        <!-- END: NEW PROCESS SCHEDULE UI -->
                    </div>
                </div>
                <!-- START: AUTHENTICATION ACCORDION -->
                <div class="accordion-item">
                    <button class="accordion-header">
                        <div>
                            <span class="accordion-title"
                                ><i class="fas fa-user-shield"></i> Authentication Settings</span
                            >
                            <span class="accordion-description">Change your administrator username and password</span>
                        </div>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="accordion-panel">
                        <div class="form-group">
                            <label for="new_username">
                                Username
                                <small style="display: block; font-weight: normal; color: #6c757d"
                                    >Current username is: <strong>{{ settings.username or 'admin' }}</strong></small
                                >
                            </label>
                            <input
                                type="text"
                                id="new_username"
                                name="new_username"
                                value="{{ settings.username or 'admin' }}"
                                class="setting-input"
                                data-path="username"
                                data-initial-username="{{ settings.username or 'admin' }}"
                            />
                        </div>
                        <div class="form-group">
                            <label for="new_password">
                                New Password
                                <small style="display: block; font-weight: normal; color: #6c757d"
                                    >Leave blank to keep the current password.</small
                                >
                            </label>
                            <input
                                type="password"
                                id="new_password"
                                name="new_password"
                                minlength="8"
                                class="setting-input"
                                data-path="password"
                                autocomplete="new-password"
                            />
                        </div>
                        <div class="form-group">
                            <label for="confirm_password">Confirm New Password</label>
                            <input
                                type="password"
                                id="confirm_password"
                                name="confirm_password"
                                minlength="8"
                                autocomplete="new-password"
                            />
                        </div>
                    </div>
                </div>
                <!-- END: AUTHENTICATION ACCORDION -->
            </div>

            <!-- Page Footer with Buttons -->
            <div
                style="
                    padding-top: 20px;
                    border-top: 1px solid #dee2e6;
                    display: flex;
                    justify-content: space-between;
                    margin-top: 2em;
                "
            >
                <div>
                    <button
                        id="export-settings-btn"
                        class="action-button"
                        style="font-size: 1em; background: #e9ecef; border: 1px solid #dee2e6; color: #495057"
                    >
                        <i class="fas fa-file-export"></i> Export as JSON
                    </button>
                    <button
                        id="import-settings-btn"
                        class="action-button"
                        style="font-size: 1em; background: #e9ecef; border: 1px solid #dee2e6; color: #495057"
                    >
                        <i class="fas fa-file-import"></i> Import from JSON
                    </button>
                </div>
                <button id="save-settings-btn" class="action-button blue">Save Changes</button>
            </div>
        </div>
        <div id="confirmation-modal" class="modal-overlay">
            <div class="modal-content" style="max-width: 450px; text-align: center">
                <div class="modal-header">
                    <h2 id="confirmation-title" style="width: 100%; text-align: center">
                        <i class="fas fa-exclamation-triangle" style="color: #dc3545"></i> Are you sure?
                    </h2>
                </div>
                <div class="modal-body">
                    <p id="confirmation-message" style="font-size: 1.1em"></p>
                </div>
                <div class="modal-footer" style="justify-content: center; gap: 1em">
                    <button id="confirmation-cancel-btn" class="action-button">Cancel</button>
                    <button id="confirmation-confirm-btn" class="action-button blue">Confirm</button>
                </div>
            </div>
        </div>

        <input type="file" id="import-file-input" style="display: none" accept=".json" />

        <div id="custom-alert-modal" class="modal-overlay">
            <div class="modal-content" style="max-width: 450px; text-align: center">
                <div class="modal-header">
                    <h2 id="custom-alert-title" style="width: 100%; text-align: center"></h2>
                </div>
                <div class="modal-body">
                    <p id="custom-alert-message" style="font-size: 1.1em"></p>
                </div>
                <div class="modal-footer" style="justify-content: center">
                    <button id="custom-alert-ok-btn" class="action-button blue">OK</button>
                </div>
            </div>
        </div>

        <!-- Load shared helper functions first -->
        <script src="{{ url_for('static', filename='js/ui.js') }}"></script>

        <!-- Load the page-specific logic for the settings page -->
        <script src="{{ url_for('static', filename='js/settings.js') }}"></script>

        <!-- Load the theme switcher last -->
        <script src="{{ url_for('static', filename='js/theme.js') }}"></script>

        <!-- Server Status Footer -->
        <div class="server-status-footer">
            <span class="status-indicator"></span>
            <span>Server Online</span>
            <span>{{ server_version }}</span>
        </div>
    </body>
</html>
